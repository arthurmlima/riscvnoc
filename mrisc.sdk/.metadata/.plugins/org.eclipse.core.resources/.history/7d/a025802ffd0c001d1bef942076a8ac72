/******************************************************************************
*
* Copyright (C) 2009 - 2014 Xilinx, Inc.  All rights reserved.
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* Use of the Software is limited solely to applications:
* (a) running on a Xilinx device, or
* (b) that interact with a Xilinx device through a bus or interconnect.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
* XILINX  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF
* OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* Except as contained in this notice, the name of the Xilinx shall not be used
* in advertising or otherwise to promote the sale, use or other dealings in
* this Software without prior written authorization from Xilinx.
*
******************************************************************************/

/*
 * helloworld.c: simple test application
 *
 * This application configures UART 16550 to baud rate 9600.
 * PS7 UART (Zynq) is not initialized by this application, since
 * bootrom/bsp configures it to baud rate 115200
 *
 * ------------------------------------------------
 * | UART TYPE   BAUD RATE                        |
 * ------------------------------------------------
 *   uartns550   9600
 *   uartlite    Configurable only in HW design
 *   ps7_uart    115200 (configured by bootrom/bsp)
 */

#include <stdio.h>
#include "platform.h"
#include "sleep.h"
#include <stdlib.h>


#include "xparameters.h"
#include "xil_printf.h"
#include "xil_types.h"

enum {
	VIS_OK,
	VIS_ERROR
};

#define VIS_BASE_ADDRESS	XPAR_ZCU104_0_BASEADDR

typedef struct
{
	volatile u32 ADDR;
	volatile u32 DIN;
	volatile u32 DOUT;
	volatile u32 RST;
} Vis_AxiStruct;

#define VIS_AXI				((Vis_AxiStruct *)VIS_BASE_ADDRESS)

/* General Purpose Register - Control Bits */
#define VIS_AXI_EN			((u32 )0x00000001)
#define VIS_AXI_WEN			((u32 )0x0000001E) // HABILITA TUDO

/* General Purpose Register - Status Bits */
#define VIS_AXI_OK			((u32 )0x00100000)

/* Address Register */
#define VIS_AXI_ADR			((u32)0x000FFFE0)
#define VIS_AXI_ADR_SHIFT	0UL
#define VIS_AXI_ADR_MASK	((u32)0xFFFFFFFF)

/* Data In Register */
#define VIS_AXI_DTI			((u32)0x00000001)
#define VIS_AXI_DTI_SHIFT	0UL
#define VIS_AXI_DTI_MASK	((u32)0xFFFFFFFF)

/* Data Out Register */
#define VIS_AXI_DTO			((u32)0x00000001)
#define VIS_AXI_DTO_SHIFT	0UL
#define VIS_AXI_DTO_MASK	((u32)0xFFFFFFFF)


#define text_size 670
#define data_size 54

u32 program[4000];

u32 text[2000]=
{
    0xff010113,
	0x00112623,
	0x00812423,
	0x01010413,
	0x00a005b3,
	0xfea40ba3,
	0xff744503,
	0x00a00613,
	0x00c51c63,
	0x0040006f,
	0x00d00513,
	0x00000317,
	0xfd4300e7,
	0x0040006f,
	0xff744503,
	0x020005b7,
	0x00a5a423,
	0x00812403,
	0x00c12083,
	0x01010113,
	0x00008067,
	0xff010113,
	0x00112623,
	0x00812423,
	0x01010413,
	0xfea42a23,
	0x0040006f,
	0xff442503,
	0x00054503,
	0x000005b3,
	0x02b50263,
	0x0040006f,
	0xff442503,
	0x00150593,
	0xfeb42a23,
	0x00054503,
	0x00000317,
	0xf70300e7,
	0xfd5ff06f,
	0x00812403,
	0x00c12083,
	0x01010113,
	0x00008067,
	0xfe010113,
	0x00112e23,
	0x00812c23,
	0x02010413,
	0xfea42a23,
	0xfeb42823,
	0x00700513,
	0xfea42623,
	0x0040006f,
	0xfec42503,
	0x000005b3,
	0x06b54e63,
	0x0040006f,
	0xff442503,
	0xfec42583,
	0x00259593,
	0x00b55533,
	0x00f57513,
	0x000025b7,
	0x00058593,
	0x00b50533,
	0x00050503,
	0xfea405a3,
	0xfeb44503,
	0x03000593,
	0x00b51e63,
	0x0040006f,
	0xfec42503,
	0xff042583,
	0x00b54663,
	0x0040006f,
	0x01c0006f,
	0xfeb44503,
	0x00000317,
	0xed0300e7,
	0xfec42503,
	0xfea42823,
	0x0040006f,
	0xfec42503,
	0xfff50513,
	0xfea42623,
	0xf81ff06f,
	0x01812403,
	0x01c12083,
	0x02010113,
	0x00008067,
	0xff010113,
	0x00112623,
	0x00812423,
	0x01010413,
	0xfea42a23,
	0xff442503,
	0x3e800593,
	0x00b56e63,
	0x0040006f,
	0x00002537,
	0x01150513,
	0x00000317,
	0xec4300e7,
	0x5180006f,
	0xff442503,
	0x38400593,
	0x02b56263,
	0x0040006f,
	0x03900513,
	0x00000317,
	0xe50300e7,
	0xff442503,
	0xc7c50513,
	0xfea42a23,
	0x1840006f,
	0xff442503,
	0x32000593,
	0x02b56263,
	0x0040006f,
	0x03800513,
	0x00000317,
	0xe24300e7,
	0xff442503,
	0xce050513,
	0xfea42a23,
	0x1540006f,
	0xff442503,
	0x2bc00593,
	0x02b56263,
	0x0040006f,
	0x03700513,
	0x00000317,
	0xdf8300e7,
	0xff442503,
	0xd4450513,
	0xfea42a23,
	0x1240006f,
	0xff442503,
	0x25800593,
	0x02b56263,
	0x0040006f,
	0x03600513,
	0x00000317,
	0xdcc300e7,
	0xff442503,
	0xda850513,
	0xfea42a23,
	0x0f40006f,
	0xff442503,
	0x1f400593,
	0x02b56263,
	0x0040006f,
	0x03500513,
	0x00000317,
	0xda0300e7,
	0xff442503,
	0xe0c50513,
	0xfea42a23,
	0x0c40006f,
	0xff442503,
	0x19000593,
	0x02b56263,
	0x0040006f,
	0x03400513,
	0x00000317,
	0xd74300e7,
	0xff442503,
	0xe7050513,
	0xfea42a23,
	0x0940006f,
	0xff442503,
	0x12c00593,
	0x02b56263,
	0x0040006f,
	0x03300513,
	0x00000317,
	0xd48300e7,
	0xff442503,
	0xed450513,
	0xfea42a23,
	0x0640006f,
	0xff442503,
	0x0c800593,
	0x02b56263,
	0x0040006f,
	0x03200513,
	0x00000317,
	0xd1c300e7,
	0xff442503,
	0xf3850513,
	0xfea42a23,
	0x0340006f,
	0xff442503,
	0x06400593,
	0x02b56263,
	0x0040006f,
	0x03100513,
	0x00000317,
	0xcf0300e7,
	0xff442503,
	0xf9c50513,
	0xfea42a23,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0xff442503,
	0x05a00593,
	0x02b56263,
	0x0040006f,
	0x03900513,
	0x00000317,
	0xca4300e7,
	0xff442503,
	0xfa650513,
	0xfea42a23,
	0x1840006f,
	0xff442503,
	0x05000593,
	0x02b56263,
	0x0040006f,
	0x03800513,
	0x00000317,
	0xc78300e7,
	0xff442503,
	0xfb050513,
	0xfea42a23,
	0x1540006f,
	0xff442503,
	0x04600593,
	0x02b56263,
	0x0040006f,
	0x03700513,
	0x00000317,
	0xc4c300e7,
	0xff442503,
	0xfba50513,
	0xfea42a23,
	0x1240006f,
	0xff442503,
	0x03c00593,
	0x02b56263,
	0x0040006f,
	0x03600513,
	0x00000317,
	0xc20300e7,
	0xff442503,
	0xfc450513,
	0xfea42a23,
	0x0f40006f,
	0xff442503,
	0x03200593,
	0x02b56263,
	0x0040006f,
	0x03500513,
	0x00000317,
	0xbf4300e7,
	0xff442503,
	0xfce50513,
	0xfea42a23,
	0x0c40006f,
	0xff442503,
	0x02800593,
	0x02b56263,
	0x0040006f,
	0x03400513,
	0x00000317,
	0xbc8300e7,
	0xff442503,
	0xfd850513,
	0xfea42a23,
	0x0940006f,
	0xff442503,
	0x01e00593,
	0x02b56263,
	0x0040006f,
	0x03300513,
	0x00000317,
	0xb9c300e7,
	0xff442503,
	0xfe250513,
	0xfea42a23,
	0x0640006f,
	0xff442503,
	0x01400593,
	0x02b56263,
	0x0040006f,
	0x03200513,
	0x00000317,
	0xb70300e7,
	0xff442503,
	0xfec50513,
	0xfea42a23,
	0x0340006f,
	0xff442503,
	0x00a00593,
	0x02b56263,
	0x0040006f,
	0x03100513,
	0x00000317,
	0xb44300e7,
	0xff442503,
	0xff650513,
	0xfea42a23,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0xff442503,
	0x00900593,
	0x02b56263,
	0x0040006f,
	0x03900513,
	0x00000317,
	0xaf8300e7,
	0xff442503,
	0xff750513,
	0xfea42a23,
	0x1940006f,
	0xff442503,
	0x00800593,
	0x02b56263,
	0x0040006f,
	0x03800513,
	0x00000317,
	0xacc300e7,
	0xff442503,
	0xff850513,
	0xfea42a23,
	0x1640006f,
	0xff442503,
	0x00700593,
	0x02b56263,
	0x0040006f,
	0x03700513,
	0x00000317,
	0xaa0300e7,
	0xff442503,
	0xff950513,
	0xfea42a23,
	0x1340006f,
	0xff442503,
	0x00600593,
	0x02b56263,
	0x0040006f,
	0x03600513,
	0x00000317,
	0xa74300e7,
	0xff442503,
	0xffa50513,
	0xfea42a23,
	0x1040006f,
	0xff442503,
	0x00500593,
	0x02b56263,
	0x0040006f,
	0x03500513,
	0x00000317,
	0xa48300e7,
	0xff442503,
	0xffb50513,
	0xfea42a23,
	0x0d40006f,
	0xff442503,
	0x00400593,
	0x02b56263,
	0x0040006f,
	0x03400513,
	0x00000317,
	0xa1c300e7,
	0xff442503,
	0xffc50513,
	0xfea42a23,
	0x0a40006f,
	0xff442503,
	0x00300593,
	0x02b56263,
	0x0040006f,
	0x03300513,
	0x00000317,
	0x9f0300e7,
	0xff442503,
	0xffd50513,
	0xfea42a23,
	0x0740006f,
	0xff442503,
	0x00200593,
	0x02b56263,
	0x0040006f,
	0x03200513,
	0x00000317,
	0x9c4300e7,
	0xff442503,
	0xffe50513,
	0xfea42a23,
	0x0440006f,
	0xff442503,
	0x000005b3,
	0x02b50263,
	0x0040006f,
	0x03100513,
	0x00000317,
	0x998300e7,
	0xff442503,
	0xfff50513,
	0xfea42a23,
	0x0140006f,
	0x03000513,
	0x00000317,
	0x97c300e7,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x0040006f,
	0x00812403,
	0x00c12083,
	0x01010113,
	0x00008067,
	0xfe010113,
	0x00112e23,
	0x00812c23,
	0x02010413,
	0xfea42a23,
	0xfff00513,
	0xfea42823,
	0xc00025f3,
	0xfeb42623,
	0x030005b7,
	0x00a5a023,
	0xff442503,
	0x000005b3,
	0x00b50c63,
	0x0040006f,
	0xff442503,
	0x00000317,
	0x954300e7,
	0x0040006f,
	0x0040006f,
	0xff042503,
	0xfff00593,
	0x08b51063,
	0x0040006f,
	0xc0002573,
	0xfea42423,
	0xfe842503,
	0xfec42583,
	0x40b50533,
	0xfea42223,
	0xfe442503,
	0x00b725b7,
	0xb0158593,
	0x04b56263,
	0x0040006f,
	0xff442503,
	0x000005b3,
	0x00b50c63,
	0x0040006f,
	0xff442503,
	0x00000317,
	0x8f4300e7,
	0x0040006f,
	0xfe842503,
	0xfea42623,
	0x03000537,
	0x00052583,
	0xfff5c593,
	0x00b52023,
	0x0040006f,
	0x02000537,
	0x00852503,
	0xfea42823,
	0xf7dff06f,
	0x03000537,
	0x000005b3,
	0x00b52023,
	0xff044503,
	0x01812403,
	0x01c12083,
	0x02010113,
	0x00008067,
	0xff010113,
	0x00112623,
	0x00812423,
	0x01010413,
	0x00000533,
	0x00000317,
	0xef4300e7,
	0x00812403,
	0x00c12083,
	0x01010113,
	0x00008067,
	0xfd010113,
	0x02112623,
	0x02812423,
	0x03010413,
	0x02000537,
	0x36400593,
	0x00b52223,
	0x00002537,
	0x01850513,
	0xfca42823,
	0x00000317,
	0x848300e7,
	0x00002537,
	0x01a50513,
	0x00000317,
	0x838300e7,
	0x00002537,
	0x04050513,
	0x00000317,
	0x828300e7,
	0x00002537,
	0x06750513,
	0x00000317,
	0x818300e7,
	0x00002537,
	0x08a50513,
	0x00000317,
	0x808300e7,
	0x00002537,
	0x0b050513,
	0xfffff317,
	0x7f8300e7,
	0xfd042503,
	0xfffff317,
	0x7ec300e7,
	0x0040006f,
	0x00000533,
	0xfea42a23,
	0x0040006f,
	0xff442503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xff442503,
	0x00150513,
	0xfea42a23,
	0xfddff06f,
	0x00000533,
	0xfea42823,
	0x0040006f,
	0xff042503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xff042503,
	0x00150513,
	0xfea42823,
	0xfddff06f,
	0x00000533,
	0xfea42623,
	0x0040006f,
	0xfec42503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xfec42503,
	0x00150513,
	0xfea42623,
	0xfddff06f,
	0x03000537,
	0x00300593,
	0x00b52023,
	0x00000533,
	0xfea42423,
	0x0040006f,
	0xfe842503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xfe842503,
	0x00150513,
	0xfea42423,
	0xfddff06f,
	0x00000533,
	0xfea42223,
	0x0040006f,
	0xfe442503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xfe442503,
	0x00150513,
	0xfea42223,
	0xfddff06f,
	0x00000533,
	0xfea42023,
	0x0040006f,
	0xfe042503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xfe042503,
	0x00150513,
	0xfea42023,
	0xfddff06f,
	0x03000537,
	0x00700593,
	0x00b52023,
	0x00000533,
	0xfca42e23,
	0x0040006f,
	0xfdc42503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xfdc42503,
	0x00150513,
	0xfca42e23,
	0xfddff06f,
	0x00000533,
	0xfca42c23,
	0x0040006f,
	0xfd842503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xfd842503,
	0x00150513,
	0xfca42c23,
	0xfddff06f,
	0x00000533,
	0xfca42a23,
	0x0040006f,
	0xfd442503,
	0x0000f5b7,
	0xa5f58593,
	0x00a5ce63,
	0x0040006f,
	0x0040006f,
	0xfd442503,
	0x00150513,
	0xfca42a23,
	0xfddff06f,
	0x03000537,
	0x00f00593,
	0x00b52023,
	0xe09ff06f,
};

u32 data[54]=
{
	0x33323130,
	0x37363534,
	0x62613938,
	0x66656463,
	0x313d3e00,
	0x00303030,
	0x2020000a,
	0x5f5f5f5f,
	0x205f2020,
	0x20202020,
	0x20202020,
	0x5f5f5f20,
	0x2020205f,
	0x20202020,
	0x5f5f2020,
	0x000a5f5f,
	0x20207c20,
	0x285c205f,
	0x5f20295f,
	0x5f205f5f,
	0x202f5f5f,
	0x7c5f5f5f,
	0x5f5f2020,
	0x2f20205f,
	0x5f5f5f20,
	0x20000a7c,
	0x5f7c207c,
	0x207c2029,
	0x5f202f7c,
	0x5f202f5f,
	0x5f5f5c20,
	0x205c205f,
	0x205f202f,
	0x7c207c5c,
	0x7c20000a,
	0x5f5f2020,
	0x7c207c2f,
	0x7c5f2820,
	0x295f2820,
	0x5f5f7c20,
	0x207c2029,
	0x20295f28,
	0x5f7c207c,
	0x000a5f5f,
	0x7c5f7c20,
	0x7c202020,
	0x5f5c7c5f,
	0x5f5c5f5f,
	0x5f2f5f5f,
	0x2f5f5f5f,
	0x5f5f5c20,
	0x5c202f5f,
	0x5f5f5f5f,
	0x00000a7c,
};


int main()
{

    init_platform();



    for(int k=0;k<4000;k++)
    {
    	if(k<=667)
    	program[k]=text[k];
    	else if(k>=8192/4 && k<=0x2FFC/4)
    	program[k]=data[k];
    	else
    	{
    	program[k] =0;
    	}

    }








for(int i=0;i<723;i++)
{
    VIS_AXI->DIN = (u32 ) program[i];
    VIS_AXI->ADDR |= VIS_AXI_WEN ;
    VIS_AXI->ADDR |= ((u32)i << 5);

    VIS_AXI->ADDR |= VIS_AXI_EN ; // Gatilho do enable por ultimo

   while(!(VIS_AXI->ADDR & VIS_AXI_OK)){
    	__asm("nop");
   }
    VIS_AXI->ADDR =0;
}






    VIS_AXI->RST=0;
    usleep(50);


    while(1){
    VIS_AXI->RST = 1;
    }







    cleanup_platform();
    return 0;
}
